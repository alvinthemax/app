<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GitHub PAT File Browser</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --item: #1f2937;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --line: #4b5563;
      --input-bg: #1e293b;
      --button-bg: #2563eb;
      --sidebar-bg: #0f172a;
      --sidebar-width: 320px;
      --header-height: 60px;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.5;
      overflow-x: hidden;
    }
    
    /* Header */
    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--header-height);
      background: var(--panel);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      padding: 0 20px;
      z-index: 1000;
    }
    
    .hamburger-btn {
      background: none;
      border: none;
      color: var(--text);
      font-size: 24px;
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      margin-right: 20px;
      transition: background 0.2s;
    }
    
    .hamburger-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .header-title {
      font-weight: 600;
      font-size: 18px;
      flex: 1;
    }
    
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      width: var(--sidebar-width);
      height: calc(100vh - var(--header-height));
      background: var(--sidebar-bg);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 999;
      overflow-y: auto;
    }
    
    .sidebar.open {
      transform: translateX(0);
    }
    
    /* Overlay */
    .sidebar-overlay {
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 998;
      display: none;
    }
    
    .sidebar-overlay.open {
      display: block;
    }
    
    /* Sidebar Content */
    .sidebar-content {
      padding: 20px;
    }
    
    /* Github Settings Section */
    .github-settings {
      margin-bottom: 25px;
    }
    
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      margin-bottom: 15px;
    }
    
    .settings-title {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .settings-arrow {
      transition: transform 0.2s;
      font-size: 12px;
    }
    
    .settings-arrow.open {
      transform: rotate(180deg);
    }
    
    .settings-content {
      padding: 0 12px;
    }
    
    /* PAT Input */
    .pat-section {
      margin-bottom: 20px;
    }
    
    .pat-label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .pat-input-group {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .pat-input {
      flex: 1;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--line);
      border-radius: 6px;
      color: var(--text);
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      font-size: 13px;
    }
    
    .pat-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
    }
    
    .pat-input::placeholder {
      color: var(--muted);
    }
    
    .pat-help {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    /* Mode Tabs (Ketik | Selector) */
    .mode-tabs {
      display: flex;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.05);
      padding: 4px;
      margin-bottom: 20px;
    }
    
    .mode-tab {
      flex: 1;
      padding: 10px 12px;
      background: none;
      border: none;
      color: var(--muted);
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      transition: all 0.2s;
      border-radius: 6px;
      text-align: center;
    }
    
    .mode-tab.active {
      background: rgba(255, 255, 255, 0.1);
      color: var(--accent);
    }
    
    .mode-content {
      display: none;
    }
    
    .mode-content.active {
      display: block;
    }
    
    /* Form Styles */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 500;
    }
    
    .form-input {
      width: 100%;
      padding: 10px 12px;
      background: var(--input-bg);
      border: 1px solid var(--line);
      border-radius: 6px;
      color: var(--text);
      font-size: 14px;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-help {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    /* Selector Content */
    .selector-content {
      margin-top: 20px;
    }
    
    .selector-header {
      margin-bottom: 15px;
    }
    
    .load-btn {
      width: 100%;
      padding: 12px;
      background: var(--button-bg);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      margin-bottom: 15px;
    }
    
    .load-btn:hover:not(:disabled) {
      background: #1d4ed8;
      transform: translateY(-1px);
    }
    
    .load-btn:disabled {
      background: var(--muted);
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .load-btn.loading {
      position: relative;
      color: transparent;
    }
    
    .load-btn.loading::after {
      content: '';
      position: absolute;
      width: 16px;
      height: 16px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* Status */
    .status {
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 13px;
      margin-bottom: 15px;
      display: none;
    }
    
    .status.success {
      display: block;
      background: rgba(34, 197, 94, 0.1);
      color: var(--accent);
      border-left: 3px solid var(--accent);
    }
    
    .status.error {
      display: block;
      background: rgba(239, 68, 68, 0.1);
      color: #f87171;
      border-left: 3px solid #f87171;
    }
    
    .status.loading {
      display: block;
      background: rgba(59, 130, 246, 0.1);
      color: #60a5fa;
      border-left: 3px solid #60a5fa;
    }
    
    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .stat-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 6px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 18px;
      font-weight: 600;
      color: var(--accent);
      display: block;
    }
    
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    /* File Browser */
    .file-browser {
      background: var(--panel);
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      max-height: 500px;
      overflow-y: auto;
    }
    
    .browser-header {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      background: var(--panel);
      z-index: 1;
    }
    
    .browser-title {
      font-weight: 600;
      font-size: 14px;
    }
    
    .browser-subtitle {
      color: var(--muted);
      font-size: 12px;
      margin-top: 2px;
    }
    
    .compact-tree {
      padding: 15px;
    }
    
    .tree-node {
      margin: 3px 0;
      font-size: 13px;
    }
    
    .tree-node-content {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      user-select: none;
    }
    
    .tree-node-content:hover {
      background: rgba(255, 255, 255, 0.05);
    }
    
    .tree-node-content.selected {
      background: rgba(34, 197, 94, 0.1);
      color: var(--accent);
    }
    
    .tree-node-icon {
      width: 14px;
      height: 14px;
      flex-shrink: 0;
      opacity: 0.7;
    }
    
    .tree-node-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
    }
    
    .tree-node-arrow {
      width: 12px;
      height: 12px;
      opacity: 0.5;
      transition: transform 0.2s;
    }
    
    .tree-node.open > .tree-node-content > .tree-node-arrow {
      transform: rotate(90deg);
    }
    
    .tree-children {
      padding-left: 20px;
      display: none;
    }
    
    .tree-node.open > .tree-children {
      display: block;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
    }
    
    .empty-icon {
      font-size: 32px;
      margin-bottom: 10px;
      opacity: 0.5;
    }
    
    /* Main Content */
    .main-content {
      margin-top: var(--header-height);
      padding: 20px;
      transition: margin-left 0.3s ease;
    }
    
    .main-content.sidebar-open {
      margin-left: var(--sidebar-width);
    }
    
    /* Welcome Message */
    .welcome-message {
      max-width: 600px;
      margin: 40px auto;
      text-align: center;
      padding: 40px;
      background: var(--panel);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .welcome-icon {
      font-size: 48px;
      margin-bottom: 20px;
    }
    
    .welcome-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    
    .welcome-text {
      color: var(--muted);
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
      }
      
      .main-content.sidebar-open {
        margin-left: 0;
      }
      
      .stats {
        grid-template-columns: 1fr;
      }
      
      .file-browser {
        max-height: 400px;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="hamburger-btn" id="hamburgerBtn">
      ‚ò∞
    </button>
    <div class="header-title">GitHub File Browser</div>
  </header>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-content">
      <!-- Github Settings -->
      <div class="github-settings">
        <div class="settings-header" id="settingsToggle">
          <div class="settings-title">
            <span>‚öôÔ∏è</span>
            <span>Pengaturan Github</span>
          </div>
          <div class="settings-arrow open">‚ñº</div>
        </div>
        
        <div class="settings-content">
          <!-- PAT Input -->
          <div class="pat-section">
            <div class="pat-label">PAT</div>
            <div class="pat-input-group">
              <input 
                type="password" 
                class="pat-input" 
                id="patInput"
                placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
                spellcheck="false"
                autocomplete="off"
              />
            </div>
            <div class="pat-help">Personal Access Token dari GitHub</div>
          </div>
          
          <!-- Mode Tabs (Ketik | Selector) -->
          <div class="mode-tabs">
            <button class="mode-tab active" data-mode="type">Ketik</button>
            <button class="mode-tab" data-mode="select">Selector</button>
          </div>
          
          <!-- Ketik Mode Content -->
          <div class="mode-content active" id="typeContent">
            <div class="form-group">
              <label class="form-label">Username</label>
              <input 
                type="text" 
                class="form-input" 
                id="username"
                placeholder="doodz"
                spellcheck="false"
              />
              <div class="form-help">Username GitHub Anda</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Jalur Repositori</label>
              <input 
                type="text" 
                class="form-input" 
                id="repoPath"
                placeholder="storage"
                spellcheck="false"
              />
              <div class="form-help">Path default untuk repositori</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">Jalur File</label>
              <input 
                type="text" 
                class="form-input" 
                id="filePath"
                placeholder="data/data.json"
                spellcheck="false"
              />
              <div class="form-help">Path default untuk file</div>
            </div>
          </div>
          
          <!-- Selector Mode Content -->
          <div class="mode-content" id="selectContent">
            <div class="selector-content">
              <button class="load-btn" id="loadBtn">
                Load Repositories
              </button>
              
              <div class="status" id="status"></div>
              
              <div class="stats" id="stats" style="display: none;">
                <div class="stat-item">
                  <span class="stat-value" id="repoCount">0</span>
                  <span class="stat-label">Repos</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="folderCount">0</span>
                  <span class="stat-label">Folder</span>
                </div>
                <div class="stat-item">
                  <span class="stat-value" id="fileCount">0</span>
                  <span class="stat-label">File</span>
                </div>
              </div>
              
              <div class="file-browser" id="fileBrowser" style="display: none;">
                <div class="browser-header">
                  <div class="browser-title">Repository Browser</div>
                  <div class="browser-subtitle" id="selectedPath">Pilih file</div>
                </div>
                <div class="compact-tree" id="compactTree">
                  <!-- Tree akan dimuat di sini -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content" id="mainContent">
    <div class="welcome-message">
      <div class="welcome-icon">üöÄ</div>
      <div class="welcome-title">Selamat Datang di GitHub File Browser</div>
      <div class="welcome-text">
        Buka sidebar dengan mengklik tombol hamburger di pojok kiri atas<br>
        Masukkan PAT GitHub Anda di tab Ketik, lalu beralih ke tab Selector untuk memuat dan menjelajahi repositori Anda.
      </div>
      <button class="load-btn" id="openSidebarBtn" style="max-width: 200px;">
        Buka Sidebar
      </button>
    </div>
  </main>

  <script>
    // DOM Elements
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const openSidebarBtn = document.getElementById('openSidebarBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const mainContent = document.getElementById('mainContent');
    const settingsToggle = document.getElementById('settingsToggle');
    const settingsArrow = settingsToggle.querySelector('.settings-arrow');
    
    // Mode elements
    const modeTabs = document.querySelectorAll('.mode-tab');
    const modeContents = document.querySelectorAll('.mode-content');
    
    // Input elements
    const patInput = document.getElementById('patInput');
    const usernameInput = document.getElementById('username');
    const repoPathInput = document.getElementById('repoPath');
    const filePathInput = document.getElementById('filePath');
    const loadBtn = document.getElementById('loadBtn');
    
    // Status elements
    const status = document.getElementById('status');
    const stats = document.getElementById('stats');
    const repoCount = document.getElementById('repoCount');
    const folderCount = document.getElementById('folderCount');
    const fileCount = document.getElementById('fileCount');
    
    // File browser elements
    const fileBrowser = document.getElementById('fileBrowser');
    const compactTree = document.getElementById('compactTree');
    const selectedPath = document.getElementById('selectedPath');
    
    // State
    let currentToken = '';
    let repositories = [];
    let currentMode = 'type';
    let isLoading = false;

    // Load settings from localStorage
    function loadSettings() {
      const settings = JSON.parse(localStorage.getItem('github_settings') || '{}');
      
      patInput.value = settings.pat || '';
      usernameInput.value = settings.username || '';
      repoPathInput.value = settings.repoPath || 'storage';
      filePathInput.value = settings.filePath || 'data/data.json';
      currentMode = settings.lastMode || 'type';
      
      currentToken = settings.pat || '';
      
      // Set active mode
      setActiveMode(currentMode);
    }

    // Save settings to localStorage
    function saveSettings() {
      const settings = {
        pat: patInput.value.trim(),
        username: usernameInput.value.trim(),
        repoPath: repoPathInput.value.trim(),
        filePath: filePathInput.value.trim(),
        lastMode: currentMode
      };
      
      localStorage.setItem('github_settings', JSON.stringify(settings));
      currentToken = settings.pat;
    }

    // Show status message
    function showStatus(message, type = 'info') {
      status.textContent = message;
      status.className = `status ${type}`;
      
      if (type !== 'loading') {
        setTimeout(() => {
          status.className = 'status';
          status.textContent = '';
        }, 3000);
      }
    }

    // Update stats display
    function updateStats(repoCountValue, folderCountValue, fileCountValue) {
      repoCount.textContent = repoCountValue;
      folderCount.textContent = folderCountValue;
      fileCount.textContent = fileCountValue;
      stats.style.display = 'grid';
    }

    // Set active mode
    function setActiveMode(mode) {
      currentMode = mode;
      
      // Update tab buttons
      modeTabs.forEach(tab => {
        tab.classList.toggle('active', tab.dataset.mode === mode);
      });
      
      // Update content
      modeContents.forEach(content => {
        content.classList.toggle('active', content.id === `${mode}Content`);
      });
      
      // Save mode to settings
      saveSettings();
      
      // If switching to select mode, auto-load if token exists
      if (mode === 'select' && patInput.value.trim() && !isLoading) {
        setTimeout(() => {
          if (repositories.length === 0) {
            loadRepositories();
          }
        }, 100);
      }
    }

    // Toggle sidebar
    function toggleSidebar() {
      const isOpen = sidebar.classList.toggle('open');
      sidebarOverlay.classList.toggle('open');
      mainContent.classList.toggle('sidebar-open', isOpen);
    }

    // Create tree node
    function createTreeNode(item, depth = 0) {
      const node = document.createElement('div');
      node.className = 'tree-node';
      node.dataset.type = item.type;
      node.dataset.path = item.path || item.name;
      
      if (item.type === 'dir') {
        node.classList.toggle('open', item.open || false);
      }
      
      const content = document.createElement('div');
      content.className = 'tree-node-content';
      
      let icon = 'üìÑ';
      let arrow = '';
      
      if (item.type === 'dir') {
        icon = item.open ? 'üìÇ' : 'üìÅ';
        arrow = `
          <svg class="tree-node-arrow" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/>
          </svg>
        `;
        
        content.onclick = (e) => {
          e.stopPropagation();
          
          if (item.type === 'dir') {
            item.open = !item.open;
            node.classList.toggle('open', item.open);
            
            // Load children if opening for the first time
            if (item.open && (!item.children || item.children.length === 0) && item.url) {
              loadDirectoryContent(item, node);
            }
          }
        };
      } else {
        content.onclick = () => {
          // Select file
          document.querySelectorAll('.tree-node-content.selected').forEach(el => {
            el.classList.remove('selected');
          });
          content.classList.add('selected');
          selectedPath.textContent = item.path || item.name;
        };
      }
      
      content.innerHTML = `
        ${arrow}
        <span class="tree-node-icon">${icon}</span>
        <span class="tree-node-name">${item.name}</span>
      `;
      
      node.appendChild(content);
      
      // Create children container for folders
      if (item.type === 'dir') {
        const childrenContainer = document.createElement('div');
        childrenContainer.className = 'tree-children';
        node.appendChild(childrenContainer);
        
        // Add existing children
        if (item.children && item.children.length > 0) {
          item.children.forEach(child => {
            childrenContainer.appendChild(createTreeNode(child, depth + 1));
          });
        }
      }
      
      return node;
    }

    // Load directory content from GitHub API
    async function loadDirectoryContent(item, parentNode) {
      if (!item.url || !currentToken) return;
      
      try {
        const response = await fetch(item.url, {
          headers: {
            'Authorization': `Bearer ${currentToken}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });
        
        if (!response.ok) {
          throw new Error(`Failed to load directory: ${response.status}`);
        }
        
        const contents = await response.json();
        
        // Filter and map contents
        const children = contents
          .filter(content => content.type === 'dir' || content.type === 'file')
          .map(content => ({
            name: content.name,
            type: content.type,
            url: content.url,
            path: `${item.path || item.name}/${content.name}`,
            size: content.size,
            children: content.type === 'dir' ? [] : undefined
          }));
        
        // Update item children
        item.children = children;
        
        // Update tree
        const childrenContainer = parentNode.querySelector('.tree-children');
        childrenContainer.innerHTML = '';
        
        children.forEach(child => {
          childrenContainer.appendChild(createTreeNode(child));
        });
        
        // Update stats
        updateStats(
          repositories.length,
          document.querySelectorAll('.tree-node[data-type="dir"]').length,
          document.querySelectorAll('.tree-node[data-type="file"]').length
        );
        
      } catch (error) {
        console.error('Error loading directory:', error);
        showStatus(`Error loading directory: ${error.message}`, 'error');
      }
    }

    // Load repositories from GitHub API
    async function loadRepositories() {
      const token = patInput.value.trim();
      
      if (!token) {
        showStatus('Silakan masukkan GitHub Personal Access Token', 'error');
        return;
      }
      
      if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
        showStatus('Format token tidak valid. Token GitHub harus dimulai dengan "ghp_" atau "github_pat_"', 'error');
        return;
      }
      
      // Save token
      currentToken = token;
      saveSettings();
      
      // Show loading state
      loadBtn.disabled = true;
      loadBtn.classList.add('loading');
      showStatus('Memuat repositori dari GitHub...', 'loading');
      fileBrowser.style.display = 'none';
      
      try {
        // Load repositories with pagination
        let allRepos = [];
        let page = 1;
        let hasMore = true;
        
        while (hasMore) {
          const response = await fetch(`https://api.github.com/user/repos?per_page=100&page=${page}&sort=updated`, {
            headers: {
              'Authorization': `Bearer ${token}`,
              'Accept': 'application/vnd.github.v3+json'
            }
          });
          
          if (!response.ok) {
            if (response.status === 401) {
              throw new Error('Token tidak valid atau sudah kadaluarsa');
            }
            throw new Error(`Error GitHub API: ${response.status}`);
          }
          
          const repos = await response.json();
          allRepos = [...allRepos, ...repos];
          
          // Check for more pages
          const linkHeader = response.headers.get('Link');
          hasMore = linkHeader && linkHeader.includes('rel="next"');
          page++;
          
          // Update status
          showStatus(`Memuat repositori... (${allRepos.length} ditemukan)`, 'loading');
        }
        
        if (allRepos.length === 0) {
          showStatus('Tidak ada repositori ditemukan', 'error');
          return;
        }
        
        // Process repositories
        repositories = allRepos.map(repo => ({
          name: repo.name + (repo.private ? ' üîí' : ''),
          full_name: repo.full_name,
          private: repo.private,
          url: repo.contents_url.replace('{+path}', '') + `?ref=${repo.default_branch}`,
          path: repo.name,
          type: 'dir',
          children: []
        }));
        
        // Render tree
        compactTree.innerHTML = '';
        
        // Auto-open first repository
        if (repositories.length > 0) {
          repositories[0].open = true;
          
          repositories.forEach(repo => {
            const treeNode = createTreeNode(repo);
            compactTree.appendChild(treeNode);
            
            // Auto-load first repo content
            if (repo.open) {
              loadDirectoryContent(repo, treeNode);
            }
          });
        }
        
        // Show file browser
        fileBrowser.style.display = 'block';
        
        // Update stats
        updateStats(repositories.length, 0, 0);
        
        showStatus(`Berhasil memuat ${repositories.length} repositori`, 'success');
        
      } catch (error) {
        console.error('Error loading repositories:', error);
        showStatus(`Error: ${error.message}`, 'error');
      } finally {
        loadBtn.disabled = false;
        loadBtn.classList.remove('loading');
      }
    }

    // Event Listeners
    hamburgerBtn.addEventListener('click', toggleSidebar);
    openSidebarBtn.addEventListener('click', toggleSidebar);
    sidebarOverlay.addEventListener('click', toggleSidebar);

    // Settings toggle
    settingsToggle.addEventListener('click', () => {
      settingsArrow.classList.toggle('open');
    });

    // Mode tabs switching
    modeTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        setActiveMode(tab.dataset.mode);
      });
    });

    // Load repositories
    loadBtn.addEventListener('click', loadRepositories);

    // Save settings on input changes
    patInput.addEventListener('change', saveSettings);
    usernameInput.addEventListener('change', saveSettings);
    repoPathInput.addEventListener('change', saveSettings);
    filePathInput.addEventListener('change', saveSettings);

    // Initialize
    window.addEventListener('DOMContentLoaded', () => {
      loadSettings();
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveSettings();
      }
      
      if (e.key === 'Escape' && sidebar.classList.contains('open')) {
        toggleSidebar();
      }
    });
  </script>
</body>
</html>